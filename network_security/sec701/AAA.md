# Authentication, Authorization, and Accounting (AAA)

## AAA Characteristics
### Authentication without AAA

أبسط طريقة للاوثينتيكيشن في الريموت لوج ان هي استخدام **اللوج ان والباسورد** على:
  - Console
  - VTY lines
  - AUX ports  

**العيوب**:
لا يوجد **اكونتبيليتي** (أي حد مع الباسورد يقدر يدخل ويغير الإعدادات).



#### SSH (Secure Shell)

طريقة أكثر أمانًا من التيلنيت.
  
**الخصائص**:
  - يتطلب يوزرنيم وباسورد.
  - البيانات مشفرة أثناء النقل.



#### Local Database Authentication

الوظيفه هي إنشاء حسابات مستخدمين محليًا على الجهاز.  

**القيود**:
  - لازم تكوين الحسابات **يدويًا** على كل جهاز (راوتر/سويتش).

---
### AAA Components

هي 3 مكونات أساسية لتأمين الوصول

AAA (Authentication, Authorization, and Accounting)
في بيئة سيسكو:


#### 1. Authentication (المصادقة)

 المستخدم أو المدير لازم يثبت هويته قبل الدخول للشبكة أو الموارد.  
- **الطرق**: 
  - Username + Password
  - Challenge/Response
  - Token cards
  
- **مثال**:
 "أنا المستخدم سعيد مثلا ومعايا الباسورد عشان اثبت دا."


#### 2. Authorization (التفويض)
**الوصف**:
بعد المصادقة، النظام يحدد للمستخدم:
  - أي الموارد يقدر يدخلها
  - وأي العمليات مسموح له يعملها  

**مثال**: "المستخدم سعيد مسموح له يدخل على سيرفر 2 مثلا باستخدام SSH فقط."


#### 3. Accounting (المحاسبة والتدقيق)

تسجيل نشاطات المستخدم:
  - ما الذي تم الوصول إليه
  - مدة الاستخدام
  - التغييرات التي تمت  
**الفائدة**: تتبع كيفية استخدام موارد الشبكة.  
**مثال**: "المستخدم سعيد دخل على سيرفر 2 باستخدام SSH لمدة 15 دقيقة."

---
### Authentication Modes (AAA)

`Cisco `
بيوفر طريقتين أساسيتين لتطبيق خدمات AAA:



#### 1. Local AAA Authentication
**الوصف**: 
  - يعتمد على قاعدة بيانات محلية موجودة على نفس الجهاز
  - كل المستخدمين وكلمات المرور لازم يتم تكوينهم يدويًا على الجهاز نفسه.

**الاسم الشائع**: Local AAA.


#### 2. Server-Based AAA Authentication

  - يعتمد على **خادم مركزي** (مثل: Cisco Secure ACS for Windows).
  - الخادم يحتوي على أسماء المستخدمين وكلمات المرور لجميع المستخدمين.

**البروتوكولات المستخدمة**:
  - RADIUS
  - TACACS+  
  
**الفائدة**: الإدارة أسهل وأكتر مركزية بدل ما تعرّف الحسابات يدويًا على كل جهاز.

---
### Authorization (التفويض)

**الوصف**:  
  بعد ما المستخدم يتم **مصادقته** (اوثينتيكيشن) باستخدام مصدر بيانات `تريبل اي` (سواء **محلي** أو **على سيرفر**)،  
  يتم **تحديد الصلاحيات** الخاصة به:  
  - الموارد المسموح له الوصول إليها.  
  - العمليات المسموح له تنفيذها.  

**الفائدة**:  
  يضمن إن كل مستخدم يشتغل بالصلاحيات المخصصة له فقط 
  
  (Principle of Least Privilege). 

**مثال**:  
  "المستخدم سعيد يقدر يدخل على **سيرفر 2** باستخدام **SSH فقط**."

----
### AAA - الـ Accounting

**يعني إيه؟**  
  الاكونتينج بيتعمل عن طريق سيرفر تريبل اي (زي ACS).  
  السيرفر ده بيجمع إحصائيات عن استخدام الشبكة،  
  وبتتسحب بعد كده عشان نطلع **تقارير تفصيلية** عن الشبكة وإعداداتها.  



#### أنواع الـ Accounting:

1. **Network Accounting**  

   - متابعة استهلاك الشبكة بشكل عام.  

1. **Connection Accounting**  

   - تسجيل كل اتصال (زي VPN أو PPP).  

1. **EXEC Accounting**  

   - تسجيل وقت ما المستخدم يبدأ جلسة EXEC ووقت ما يخلصها.  

1. **System Accounting**  

   - متابعة أحداث النظام (زي ريستارت الجهاز أو تغيير الحالة).  

1. **Command Accounting**  

   - تسجيل الأوامر اللي المستخدم بيكتبها أثناء الجلسة.  

---
## Configure Local AAA Authentication
### Authenticate Administrative Access

**الفكرة**:  
 الـ `Local AAA Authentication`
شبه أمر `login local`،  
بس الفرق إن التريبل اي بيدي إمكانية نعمل **اكتر من طريقة باك اب** للاوثينتيكيشن.  


#### خطوات تهيئة اللوكال تريبل اي للمسؤولين (الادمين):

1. **إضافة المستخدمين**  
   - تضيف يوزرنيم وباسسورد في قاعدة البيانات المحلية على الراوتر  
   للمسؤولين اللي محتاجين يدخلوا.  

2. **تفعيل AAA**  
   - تشغل خدمة التريبل اي بشكل عام (جلوبالي) على الراوتر.  

3. **إعداد الباراميترز**  
   - تظبط إعدادات التريبل اي المطلوبة على الراوتر.  

4. **التأكيد وحل المشاكل**  
   - تتأكد إن الإعدادات شغالة كويس، وتعمل تربلشووت لو في مشكلة.  

---
### Authentication Methods

بنستخدم الأمر:  
`aaa authentication login ...`  

  عشان نفعل اوثينتيكيشن على:
  - **Console**
  - **Aux**
  - **VTY lines**

- لو استخدمت الكلمة 
- **`default`**
يبقى التفعيل على كل اللاينز

ممكن كمان تعمل **قائمة مخصصة
- (list-name)**
بإعدادات اوثينتيكيشن مختلفة.

```cico
aaa authentication login default list-name method1 method 2
```
#### شرح مكونات الأمر:

- **default**  

بيستخدم طرق الاوثينتيكيشن اللي مكتوبة بعده كـ **قائمة افتراضية** لما أي يوزر يعمل لوج ان.  

- **list-name**  

اسم (سترينج) بتسمي بيه قائمة طرق الاوثينتيكيشن اللي هتتفعل عند تسجيل الدخول.  

- **method1 ... method4**  
  - ترتيب طرق المصادقة اللي التريبل اي هيجربها.  
  - لازم على الأقل طريقة واحدة.  
  - أقصى عدد مسموح: **4 طرق**.  


#### مثال عملي:

```cisco
aaa new-model
aaa authentication login default local
aaa authentication login SSH-ACCESS group radius local
```

- السطر الأول: بيشغل التريبل اي.
    
- السطر التاني: بيخلي الاوثينتيكيشن الافتراضية تعتمد على لوكال داتا بيز.
    
- السطر التالت: بيعمل قائمة اسمها
- **SSH-ACCESS** 
- يحاول يستخدم **ريديس** الأول ولو فشل يستخدم **لوكال داتا بيز**.
----

### Authentication Methods (Cont.)

ممكن نحدد لحد **4 طرق** مصادقة عشان يبقى فيه **Fallback** (لو طريقة وقعت يستخدم اللي بعدها).  
أمثلة:
- لو عاوز تستخدم **قاعدة بيانات محلية** الكلمة
- `local` or `local-case`
  
- لو عاوز تستخدم **الباسورد بتاع enable**
- `enable`  



#### طرق المصادقة (Methods)

| **Keyword**     | **الوصف**                                                              |
| --------------- | ---------------------------------------------------------------------- |
| `enable`        | يستخدم الاينيبل باسورد للاوثينتيكيشن.                                  |
| `local`         | يعتمد على **قاعدة البيانات المحلية** (لوكال يوزر نيم).                 |
| `local-case`    | نفس لوكال لكن **الحروف الكابيتل او سمول بتفرق**                        |
| `none`          | مفيش اوثينتيكيشن (أي حد يدخل من غير باسورد ).                          |
| `group radius`  | يستخدم كل سيرفرات **ريديس** المتعرفة.                                  |
| `group tacacs+` | يستخدم كل سيرفرات **تاكاكس+** المتعرفة.                                |
| `group <name>`  | يستخدم سب سيتس (مجموعة فرعية) من سيرفرات ريديس أو تاكاكس+ اللي متحددة. |


### مثال عملي

```cisco
aaa new-model
aaa authentication login default group radius local enable
```

الراوتر هيجرب:

1. **RADIUS servers**.

لو وقعت 
2. **Local Database**.

لو وقعت  يستخدم
3. **Enable Password**.

---
### Default and Named Authentication Methods

**المرونة**:  
  تقدر تطبق **قوائم اوثينتيكيشن مختلفة** على كل انترفيس أو لاين بشكل منفصل.  
باستخدام الأمر:  
`aaa authentication login list-name ...`


#### القوائم:

1. **Default Method List**  

دي اللي بتتطبق تلقائيًا على كل الانترفيسس واللاينز لو مفيش ليست متحددة.  

2. **Named Method List**  
   - قائمة معمولة باسم معين 
(`list-name`).  
   - لازم تتفعل بشكل صريح على الانترفيسس واللاينز بالأمر:
   
 `login authentication <list-name>`  
   - لو اتطبقت، بتاخد مكان الـ الديفولت ليست (يعني بتعمل تجاوز ليها).


#### الرجوع للديفولت
- لو حابب ترجع للـديفولت ليست على انترفيس او لاين:  
تستخدم الأمر:  
`no login authentication`


#### مثال عملي

```cisco
aaa new-model
aaa authentication login default local
aaa authentication login SSH-ACCESS group radius local

line vty 0 4
 login authentication SSH-ACCESS   ! ← Custom List
 ```

---

### Fine-Tuning the Authentication Configuration

  ممكن تزود أمان أكتر على اللاينز باستخدام الأمر: 

  `aaa local authentication attempts max-fail <number>`  

**الوظيفة**:  
  - بيأمّن حسابات التريبل اي عن طريق **قفل الحساب** بعد عدد معين من محاولات الدخول الفاشلة.  
  - الاتصال بيتقفل بعد ما يتخطى العدد المسموح.  


#### أوامر مهمة

- **تحديد عدد المحاولات المسموحة**:  

  ```cisco
  aaa local authentication attempts max-fail 3
  ```

هنا الحساب يتقفل بعد 3 محاولات فاشلة.

- **إلغاء القفل يدويًا (عن طريق الادمن)**:

    `clear aaa local user lockout`
    
 بيفتح الحسابات اللي اتقفلت.

- **عرض خصائص جلسة التريبل اي واحدة**:

    `show aaa user`
    
 بيعرض كل الاتريبيوتس الخاصة بالجلسة.


---
## Server-Based AAA Characteristics and Protocols

##  Local AAA & Server-Based AAA

| العنصر         | **Local AAA**                                        | **Server-Based AAA**                                                                    |
| -------------- | ---------------------------------------------------- | --------------------------------------------------------------------------------------- |
| **المكان**     | قاعدة بيانات محلية على الجهاز نفسه (راوتر/سويتش).    | قاعدة بيانات مركزية على سيرفر تريبل اي أو مع أنظمة خارجية (اكتيف دايريكتوري مثلا).      |
| **الإدارة**    | لازم تضيف/تعدل/تحذف كل مستخدم يدويًا على كل جهاز.    | إدارة مركزية لكل المستخدمين من مكان واحد.                                               |
| **التوسع**     | مناسب للشبكات الصغيرة أو عدد أجهزة قليل.             | مناسب للشبكات الكبيرة والمؤسسات اللي فيها أجهزة ومستخدمين كتير.                         |
| **الاعتمادية** | لو الجهاز وقع، هتفقد بيانات المستخدمين المخزنة عليه. | ممكن تعمل ريدندنسي باستخدام أكتر من سيرفر تريبل اي عشان الخدمة ما تقعش.                 |
| **التكامل**    | مفيش تكامل مع قواعد بيانات تانية.                    | ممكن يتكامل معا اكتيف دايريكتوري أو غيره لتسهيل الإدارة.                                |
| **الأمان**     | محدود، لأن كل جهاز بيحتفظ بحساباته الخاصة.           | أقوى، لأن الإدارة مركزية وبتسمح بسياسات موحدة + تسجيل الاكونتينج على مستوى الشبكة كلها. |
| **المرونة**    | بسيط وسهل التكوين.                                   | أكثر مرونة وقابلية للتخصيص حسب السياسات الأمنية للمؤسسة.                                |


----
### Cisco Identity Services Engine (ISE)

**الوصف**:  
هو **منصة سياسات هوية والتحكم في الوصول** بتساعد المؤسسات في:  
  - فرض الالتزام بالـ Compliance  
  - زيادة أمان البنية التحتية  
  - تبسيط عمليات الخدمة  

بيجمع بين:
- **Policy Definition** 
- **Control**
- **Reporting**
- وجهاز واحد يقدر يديك **إدارة شاملة** للاكسيس كنترول.

**الهدف الأساسي**:  
  وضع سياسات وصول عادلة + فرض الالتزام على كل الأجهزة المتصلة حتى الـ
  
   (**BYOD** = Bring Your Own Device).


### Importance of Cisco ISE

1. **Asset Visibility**  

يديك رؤية كاملة عن الأجهزة اللي داخلة على الشبكة.  

2. **Posture Assessment**  

يتأكد من حالة الجهاز (مثلاً: هل عليه Antivirus؟ هل محدث؟

3. **Segmentation**  

تقسيم الشبكة لسيجنمنتس مختلفة حسب نوع الجهاز أو المستخدم.  

4. **Guest Management & Secure Wireless**  

إدارة دخول الضيوف + تأمين الواي فاي

5. **Threat Containment**  

عزل أي جهاز مشبوه أو فيه تهديد بسرعة.  

---
### TACACS+ vs RADIUS Protocols

الاتنين بروتوكولات اوثينتيكيشن بيشتغلوا مع تريبل اي سيرفير.  
كل واحد ليه خصائص مختلفة.


#### TACACS+ vs RADIUS

| العنصر             | **TACACS+**                                                     | **RADIUS**                                                           |
| ------------------ | --------------------------------------------------------------- | -------------------------------------------------------------------- |
| **الوظائف**        | بيفصل بين (الاوثينتيكيشن والاوثيريزيشن والاكونتينج) مرونة أعلى. | بيدمج بين (لاوثينتيكيشن والاوثيريزيشن ) ويفصل الاكونتينج  مرونة أقل. |
| **المعيار**        | مدعوم بشكل أساسي من سيسكو.                                      | ستاندرد مفتوح لكله                                                   |
| **بروتوكول النقل** | **TCP**                                                         | **UDP**                                                              |
| **CHAP**           | **Bidirectional** Challenge & Response.                         | **Unidirectional**                                                   |
| **التشفير**        | بيشفر الباكت بالكامل.                                           | بيشفر الباسورد بس.                                                   |
| **التخصيص**        | يقدر يعمل اوثيريزيشن للأوامر على مستوى اليوزر أو الجروب.        | مفيش إمكانية لتخصيص أوامر على مستوى اليوزر أو الجروب.                |
| **الاكونتينج**     | محدود.                                                          | واسع وأكتر شمولية.                                                   |

#### الخلاصة
- **TACACS+**:
	port 49

- أفضل في التحكم (اوثيريزيشن) وأكتر أمان لإنه بيشفر الباكت كله.  
- **RADIUS**: 
	Port 1645: authentication & authorization
	Port 1646: accounting
	
	Port 1812: authentication & authorization
	Port 1813: accounting

- أفضل في الاكونتينج ومناسب أكتر للشبكات اللي محتاجة ستاندرد مفتوح.  

---
### TACACS+ Authentication

هو تطوير من سيسكو للبروتوكول الأصلي تاكاكس بيوفر **فصل كامل** بين خدمات التريبل اي.  

**المرونة**:  
  ممكن تستخدم تاك اكس لـ **اوثيريزيشن** و **الاكونتينج** بس،  
وفي نفس الوقت تستخدم طريقة تانية للاوثينتيكيشن  

####  Features of TACACS+ Authentication

1. فصل الخدمات بتاعت التريبل اي بحيث كل خدمة مستقلة عن التانية.  
2. اوثينتكيشن مرن، ممكن تتكامل مع طرق تانية.  
3. بيستخدم **بورت 49** عشان يوفر موثوقية وأمان.  
4. بيشفر الباكت بالكامل، مش الباسورد بس.  

 مثال:

1. الروتر يطلب من اليوزر يدخل **الوزرنيم والباسورد**.  
2. الروتر يبعته للسيرفر التاك اكس  
3. السيرفر يتحقق من صحة البيانات (اوثينتيكيشن).  
4. بعدين السيرفر يقرر إيه الصلاحيات اللي ياخدها اليوزر (اوثيريزيشن).  
5. كل العمليات اللي بيعملها اليوزر تتسجل (اكونتينج).

---
## Configure Server-Based Authentication
### Steps to Configure Server-Based AAA Authentication

ازاي بنفعل سيرفر قايم على التريبل اي اوثينتيكيشن؟

1. **تفعيل AAA**  
- لازم الأول تشغل التريبل اي عشان تقدر تستخدم كل عناصره.  


2. **تحديد السيرفر**  
- بتحدد السيرفر اللي هيقدم خدمات التريبل).  
- مثال (RADIUS):  


3. **إعداد مفتاح التشفير 
- لازم يتظبط عشان يضمن تشفير الاتصال بين الجهاز وسيرفر AAA.  


4. **تهيئة قائمة طرق الاوثينتيكيشن**  
- بتربط ال التريبل اي اوثينتيكيشن بالسيرفر (ممكن أكتر من سيرفر عشان الريدندنسي).  
     

**ملحوظة**
في حالة وجود أكتر من سيرفر الراوتر يجرب السيرفر الأول، ولو فشل ينتقل للتاني.  

---

### Configure TACACS+ Servers

### الخطوات:

1. **تفعيل الـ AAA**

`aaa new-model`
   `
   
2. **إنشاء TACACS+ Server جديد**
    
`tacacs server TAC_SERVER1`

2. **إضافة عنوان الـ IPv4 للسيرفر**
    
    - ممكن تحدد البورت الخاص بالمصادقة أو المحاسبة لو محتاج.
    
    
`address ipv4 192.168.1.100`

3. **تحسين الأداء باستخدام اتصال واحد (Single Connection)**
    
`single-connection`
    
4. **إضافة الـ Shared Secret Key (مفتاح التشفير)**
    
`key MySecretKey123`

4. **(اختياري) تعريف أكثر من سيرفر TACACS+**
    
    - بتكرر نفس الخطوات مع اسم مختلف:


`tacacs server TAC_SERVER2 address ipv4 192.168.1.101 key BackupKey456`


Full Code:

```CISCO
aaa new-model

tacacs server TAC_SERVER1
 address ipv4 192.168.1.100
 single-connection
 key SecretKey123
 exit
```

---
### Configure RADIUS Servers

### الخطوات:

1. **إنشاء ريديس سيرفر**
   
`radius server RADIUS1`

1. **تحديد عنوان الاي بي للسيرفر**

`address ipv4 192.168.2.100`

3. **إضافة شيرد سيكريت كي لتشفير كلمة السر**

`key RadiusSecret123`

4. **(اختياري) إضافة أكثر من سيرفر ريديس

`radius server RADIUS2  address ipv4 192.168.2.101  key BackupRadiusKey456`

---


### Configure Server-Based Authentication

بعد ما عرفت سيرفرات الـتاك اكس والريديس لازم تدمجهم في **ميثود ليسا** باستخدام:

`aaa authentication login`

مثال على قائمة ديفولت:

1. أول حاجة يجرب تاك اكس.

2. لو فشل يجرب ريديس.

3. لو فشلوا يرجع لل لوكال داتا بيز.


`aaa authentication login default group tacacs+ group radius local`

Full Example:

```cisco
! Enable AAA
aaa new-model

! TACACS+ Server
tacacs server TAC_SERVER1
 address ipv4 192.168.1.100
 key TacKey123
 single-connection

! RADIUS Server
radius server RADIUS1
 address ipv4 192.168.2.100
 key RadiusKey123

! Authentication Order: TACACS+ -> RADIUS -> Local
aaa authentication login default group tacacs+ group radius local

! Apply to VTY lines
line vty 0 4
 login authentication default

```

----
### **Feel free to contact me on** **[LinkedIn](https://www.linkedin.com/in/saeed-elfiky-61188b24b/)**
